<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />

    <title>Document</title>
  </head>

  <body>
    <%- include('nav.html') %>
    <div class="container mt-4">
      <div class="">
        <!-- <span class="border px-3 p-1 mr-3"
          ><i class="fa fa-plus"></i>&nbsp;Experience</span
        ><span class="border px-3 p-1 add-experience"
          ><i class="fa fa-plus"></i>&nbsp;Experience</span
        > -->
        <div class="container">
          <div class="row">
            <div class="col-md-12">
              <div class="panel-group" id="accordion">
                <div class="panel panel-default">
                  <div class="panel-heading mb-3">
                    <button
                      type="button"
                      class="btn btn-outline-dark glyphicon glyphicon-file"
                      data-toggle="collapse"
                      data-parent="#accordion"
                      href="#collapseOne"
                    >
                      Add Tag
                    </button>
                  </div>
                  <div id="collapseOne" class="panel-collapse collapse in">
                    <div class="panel-body">
                      <div class="row">
                        <div class="col-md-6">
                          <form action="/tags/add" method="POST">
                            <div class="form-group">
                              <input
                                type="text"
                                class="form-control"
                                name="name"
                                placeholder="Tag Name"
                              />
                            </div>
                            <button type="submit" class="btn btn-dark">
                              Add
                            </button>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <br />

      <div class="row">
        <div class="col-12">
          <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col">Tag</th>
                <th scope="col"></th>
              </tr>
            </thead>
            <tbody>
              <% for (var i=0; i < tags.length; i++){ %>
              <tr>
                <th scope="row">
                  <div class="form-check">
                    <label class="form-check-label" for="flexCheckDefault">
                      <%= tags[i].name %>
                    </label>
                  </div>
                </th>
                <th class="">
                  <button
                    data-id="<%= tags[i]._id %>"
                    type="button"
                    class="btn btn-dark delete"
                  >
                    Delete
                  </button>
                </th>
              </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script>
      $(document).on("click", ".edit", function () {
        var tagId = $(this).data("id");
        var tagName = $(this).data("value");
        console.log(tagName);
        console.log(tagId);
        $("#tagName-modal").val(tagName);
        $("#tagId-modal").val(tagId);
      });

      $(".delete").click(function (e) {
        console.log($(this));
        console.log($(this).parent("th"));
        $.ajax({
          method: "DELETE",
          url: "/tags/delete",
          // dataset.id is from: data-id= posts[i]._id
          data: { _id: e.target.dataset.id },
        })
          .done((res) => {
            // we need this form to use $this
            $(this).parent("th").parent("tr").fadeOut();
            console.log("killed");
          })
          .fail((xhr, code, err) => {
            // failure
          });
      });
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>
  </body>
</html>

<!-- Modal -->
<div
  class="modal fade"
  id="exampleModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Edit tag</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form action="tags/edit?_method=PUT" method="POST">
          <div class="form-group">
            <input
              type="text"
              class="form-control"
              id="tagName-modal"
              name="name"
              placeholder=""
            />
          </div>
          <div class="form-group" hidden>
            <input
              type="text"
              class="form-control"
              id="tagId-modal"
              name="id"
              placeholder=""
            />
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-light cancel"
              data-dismiss="modal"
            >
              Cancel
            </button>
            <button type="submit" class="btn btn-dark save">
              Save changes
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
